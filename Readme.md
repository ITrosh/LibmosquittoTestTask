## Описание
Проект представляет собой решение поставленного компанией [Лазерные системы](https://www.lsystems.ru/) тестового задания.

## Задание
Разработать прототип системы управления умным термостатом, состоящей из двух компонентов: Device (Устройство) и 
Controller (Контроллер), общающихся между собой по протоколу MQTT с использованием библиотеки libmosquitto. 
Система включает функцию настройки параметров сигнализации.

### Постановка задачи
   Система имитирует работу умного термостата, который состоит из:
   - Device (C++ приложение): Представляет собой виртуальное
   устройство с датчиком температуры, нагревателем и возможностью
   приема параметров сигнализации от пользователя.
   - Controller (C++ приложение): Приложение, которое управляет
   температурой и обрабатывает параметры сигнализации.
   Вам нужно реализовать оба этих компонента.

### Требования к компоненту Device
  Device должен:
  1. Подключаться к MQTT-брокеру (localhost:1883).
  2. Публиковать данные о текущей температуре в топик home/thermostat/temperature. 
  Температура должна быть числом в формате JSON, например: {"value": 23.5}.
  Публикация должна происходить с интервалом в 2 секунды.
  3. Подписываться на топики:
     - home/thermostat/heater для получения команд (ON/OFF).
     - home/thermostat/out/parameters/alarm для получения ответов о валидации параметров сигнализации.
  4. Иметь внутреннюю логику:
     - Начальная температура — 20.0°C.
     - Если нагреватель включен (ON), температура каждую секунду увеличивается на 0.5°C.
     - Если нагреватель выключен (OFF), температура каждую секунду уменьшается на 0.5°C.
  5. Принимать параметры сигнализации от пользователя:
     - Через аргумент командной строки --set-alarm-temp X.X, где X.X - число.
     - Публиковать полученное значение в топик home/thermostat/in/parameters/alarm в формате JSON: {"alarm_temperature": X.X}.
     - Ожидать ответ в топике home/thermostat/out/parameters/alarm и выводить пользователю результат валидации.
  6. Корректно обрабатывать подключение, отключение и ошибки MQTT.

### Требования к компоненту Controller
   Controller должен:
   1. Подключаться к MQTT-брокеру (localhost:1883).
   2. Читать целевую температуру из файла target_temperature.conf.
   3. Подписываться на топики:
      - home/thermostat/temperature (для данных с устройства).
      - home/thermostat/in/parameters/alarm (для параметров сигнализации от пользователя).
   4. Управление температурой:
      - Если текущая температура ниже целевой на 0.5°C или более, отправить команду ON.
      - Если текущая температура выше целевой на 0.5°C или более, отправить команду OFF.
   5. Обработка параметров сигнализации:
      - Валидация: При получении сообщения в home/thermostat/in/parameters/alarm проверить значение alarm_temperature. Критерии валидации:
        * Значение должно быть числом.
        * Значение должно быть в диапазоне от -10.0 до +50.0.
      - Ответ: Опубликовать в топик home/thermostat/out/parameters/alarm JSON-объект с результатом:
        * Успех: {"status": "accepted", "alarm_temperature": X.X, "message": "Alarm temperature set successfully"}
        * Ошибка: {"status": "rejected", "alarm_temperature": X.X, "message": "Error description"}
   6. Логировать все действия в консоль.
   7. Корректно обрабатывать ошибки MQTT и данные.

### Технические требования и критерии оценки
  - **Язык и стандарт**: C++17 или новее.
  - **Библиотека MQTT**: Использовать чистый C API библиотеки libmosquitto.
  - **Сборка**: Предоставить CmakeLists.txt для сборки обоих приложений.
  - **Код**:
  - Чистота, читаемость и структура кода.
  - Разделение на классы/модули (MQTT-клиент, логика термостата, обработка параметров).
  - Использование RAII и умных указателей.
  - Обработка ошибок (MQTT, парсинг JSON, аргументы командной строки).
  - Корректное завершение работы.
  - **Работоспособность**: Программы должны демонстрировать всю заявленную логику.

### Сценарии использования
  **Сценарий 1: Установка валидного параметра сигнализации**

  ```bash
    # Терминал 1: Запуск Controller
    $ ./thermostat_controller
    Connected to MQTT broker
    Subscribed to topics
    Target temperature: 22.0
  ```
  ```bash
    # Терминал 2: Запуск Device с установкой сигнализации
    $ ./thermostat_device --set-alarm-temp 25.5
    Connected to MQTT broker
    Subscribed to topics
    Alarm temperature 25.5 accepted: Alarm temperature set successfully
  ```
**Сценарий 2: Установка невалидного параметра сигнализации**
  ```bash
    $ ./thermostat_device --set-alarm-temp 60.0
    Connected to MQTT broker
    Subscribed to topics
    Alarm temperature 60.0 rejected: Temperature out of valid range (-10.0 to 50.0)
  ```
**Сценарий 3: Работа термостата продолжается во время обработки параметров**
  - Установка параметров сигнализации не должна нарушать основной цикл работы термостата.

## Программная реализация
Для решения поставленного [задания](#задание) использовались следующие средства разработки:
- [C++17](https://en.cppreference.com/w/cpp/17);
- [CMake](https://cmake.org/).

## Сборка и запуск
Для сборки нужно, находясь в корне проекта, запустить следующую команду:
- **Windows**:
    ```bash
    .\build.sh
    ```
- **Linux**:
    ```bash
    $ sudo chmod +x build.sh
    $ ./build.sh
    ```

Запуск:
- **Windows**:
  ```bash
  $ cd build/Controller
  $ thermostat_controller.exe
  
  $ cd ../Device
  $ thermostat_device.exe --set-alarm-temp <number>
  ```
- **Linux**:
  ```bash
  $ cd build/Controller
  $ ./thermostat_controller
      
  $ cd ../Device
  $ ./thermostat_device --set-alarm-temp <number>
  ```
Завершение работы программ осуществляется по нажатию клавиши Enter.
